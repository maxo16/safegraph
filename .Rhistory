installed.packages()
View(installed.packages())
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
summary(cars)
plot(pressure)
getwd()
setwd("/Users/max/Documents/GitHub/safegraph")
list.files()
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(rgdal)
library(readr)
trips <- read_csv("/Volumes/sdc-sus$/Restricted Data Library/Safegraph/processed_data/m_1_clean.csv")
places <- read_csv("/Volumes/sdc-sus$/Restricted Data Library/Safegraph/poi/safegraphplaces.csv")
View(places)
places_lat_long <- places %>% select(c(safegraph_place_id, longitude, latitude))
View(places_lat_long)
library(maptools)
library(sp)
coordinates(places_lat_long) <- ~longitude+latitude
View(places_lat_long)
class(places_lat_long)
plot(places_lat_long)
data.shape <- readOGR(dsn='/Volumes/sdc-sus$/Data Library/SanJoaquinCounty_BlockGroups', layer = "SimplyAnalytics_Shapefiles_2018-02-05_00_14_25_ce653013fadbb2ff27530d3de3790f1b")
plot(data.shape)
View(data.shape@data)
data.shape@proj4string
places_lat_long@proj4string
data.shape@proj4string
crs(places_lat_long) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "
crs(places_lat_long) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
proj4string(places_lat_long) <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
plot(places_lat_long)
joined_data <- over(places_lat_long, data.shape)
View(joined_data)
rm(joined_data)
joined_data <- over(places_lat_long, data.shape)
View(joined_data)
joined_data <- cbind(joined_data, places_lat_long@data)
View(places_lat_long)
joined_data <- over(places_lat_long, data.shape)
View(joined_data)
# Looks like it doesn't preserve the data in places_lat_long but I'll assume it preserves the order so I'll can just bind it back in.
joined_data <- cbind(joined_data, places_lat_long@data)
# Looks like it doesn't preserve the data in places_lat_long but I'll assume it preserves the order so I'll can just bind it back in.
joined_data <- cbind(joined_data, places_lat_long@data) %>% select(safegraph_place_id, bg)
# Can do more piping later to reduce lines of code
joined_data <- over(places_lat_long, data.shape)
# Looks like it doesn't preserve the data in places_lat_long but I'll assume it preserves the order so I'll can just bind it back in.
joined_data <- cbind(joined_data, places_lat_long@data) %>% select(safegraph_place_id, bg)
# Can do more piping later to reduce lines of code
joined_data <- over(places_lat_long, data.shape) %>% cbind( places_lat_long@data) %>% select(safegraph_place_id, bg)
View(trips)
# Looks like it doesn't preserve the data in places_lat_long but I'll assume it preserves the order so I'll can just bind it back in.
# joined_data <- cbind(joined_data, places_lat_long@data) %>% select(safegraph_place_id, bg)
names(joined_data)[2]
# Looks like it doesn't preserve the data in places_lat_long but I'll assume it preserves the order so I'll can just bind it back in.
# joined_data <- cbind(joined_data, places_lat_long@data) %>% select(safegraph_place_id, bg)
names(joined_data)[2] <- "dest_bg"
library(censusapi)
library(censusapi)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
census <- getCensus(name = "acs/acs5", vintage = 2017, vars = "B19013_001E",region = "block group:*", regionin = "state:06+county:077")
View(census)
census$id <- paste(census$state,census$county,census$tract,census$block_group, sep="")
census$id <- stri_sub(census$id,-11,-1)
library(stringi)
census$id <- stri_sub(census$id,-11,-1)
View(census)
census <- getCensus(name = "acs/acs5", vintage = 2017, vars = "B19013_001E",region = "block group:*", regionin = "state:06+county:077")
census$id <- paste(census$state,census$county,census$tract,census$block_group, sep="")
census$id <- stri_sub(census$id,-11,-1)
names(joined_data)
class(names(joined_data))
census$state[1]
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
census <- getCensus(name = "acs/acs5", vintage = 2017, vars = "B19013_001E",region = "block group:*", regionin = "state:06+county:077")
census$id <- paste(census$state,census$county,census$tract,census$block_group, sep="")
census$id <- stri_sub(census$id,-11,-1)
View(census)
?left_join
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
census <- getCensus(name = "acs/acs5", vintage = 2017, vars = "B19013_001E",region = "block group:*", regionin = "state:06+county:077")
census$id <- paste(census$state,census$county,census$tract,census$block_group, sep="")
census$id <- stri_sub(census$id,-11,-1)
dest_data <- joined_data %>% left_join(select(census, c("id", "B19013_001E")), by = c("dest_bg" = "id"))
str(census)
str(census)
str(joined_data)
joined_data$dest_bg <- as.character(joined_data$dest_bg)
dest_data <- joined_data %>% left_join(select(census, c("id", "B19013_001E")), by = c("dest_bg" = "id"))
View(dest_data)
names(dest_data)[3] <- "dest_inc"
trips <- trips %>% left_join(select(census, c("id", "B19013_001E")), by = c("home_bg" = "id"))
trips <- trips %>% left_join(select(census, c("id", "B19013_001E")), by = c("home_cbg" = "id"))
str(trips)
trips$home_cbg <- as.character(trips$home_cbg)
trips <- trips %>% left_join(select(census, c("id", "B19013_001E")), by = c("home_cbg" = "id"))
names(trips)[4] <- "home_inc"
final_join <- dest_data %>% left_join(trips, by = c("safegraph_place_id" = "place"))
View(final_join)
final_join <- final_join[complete.cases(final_join$home_inc),]
final_join$inc_delta <- final_join$home_cbg - final_join$dest_bg
final_join$inc_delta <- final_join$dest_inc - final_join$home_inc
